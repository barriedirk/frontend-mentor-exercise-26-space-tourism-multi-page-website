---
import BaseLayout from "../layouts/BaseLayout.astro";

import Container from "../components/Container.astro";

import data from "../data/data.json";
const { crew } = data;

const {
  images: { png, webp },
} = crew[0];
---

<BaseLayout title="Crew" urlActive="/crew">
  <Container className="pt-[100px]">
    <div class="crew mx-auto">
      <h1
        id="crew-heading"
        class="crew__title text-preset-5 flex flex-row items-center justify-center md:justify-start gap-4 uppercase mb-6"
      >
        <span class="">02</span> Meet your crew
      </h1>
      <section
        class="crew-information"
        role="region"
        aria-roledescription="carousel"
        aria-label="Crew slideshow"
      >
        <div
          class="crew-details slides"
          role="group"
          aria-live="polite"
          aria-atomic="true"
        >
          {
            crew.map(({ name, role, bio }, idx) => (
              <article
                id={`slide${idx}`}
                class={`slide slide-${idx}`}
                role="group"
                aria-roledescription="slide"
                aria-label={`${role}: ${name}`}
                aria-hidden={idx > 0 ? "true" : "false"}
                hidden={idx > 0}
              >
                <h1 class="crew-details__title text-preset-4 uppercase">
                  {role}
                </h1>

                <h2 class="crew-details__subtitle text-preset-3 uppercase">
                  {name}
                </h2>
                <p class="crew-details__description color-blue-300 text-preset-9">
                  {bio}
                </p>
              </article>
            ))
          }

          <nav
            class="slide-indicators flex justify-center gap-4 mt-22 mb-8"
            aria-label="Slide navigation"
          >
            {
              crew.map((_, idx) => (
                <button
                  type="button"
                  class="dot"
                  id={`dot${idx}`}
                  aria-label={`Go to slide ${idx + 1}`}
                  aria-current={idx === 0 ? "true" : "false"}
                />
              ))
            }
          </nav>
        </div>

        <div class="crew-picture mask-bottom-fade">
          <picture id="crewImage" class="crew-image">
            <source
              id="crewImageWebp"
              src={crew[0].images.webp}
              type="image/webp"
            />
            <img
              id="crewImageFallback"
              src={crew[0].images.png}
              alt={`Portrait of ${crew[0].name}`}
            />
          </picture>
        </div>
      </section>
    </div>

    <script define:vars={{ crew }}>
      (() => {
        const total = crew.length;
        let current = 0;
        let timeoutId;

        const nextSlide = () => {
          timeoutId = setTimeout(() => {
            const next = (current + 1) % total;

            showSlide(next);
          }, 5000);
        };

        const showSlide = (idx) => {
          clearTimeout(timeoutId);

          for (let i = 0; i < total; i++) {
            const slide = document.getElementById(`slide${i}`);
            const dot = document.getElementById(`dot${i}`);

            slide.hidden = true;
            slide.setAttribute("aria-hidden", "true");
            dot.removeAttribute("aria-current");
          }

          const currentSlide = document.getElementById(`slide${idx}`);
          const currentDot = document.getElementById(`dot${idx}`);

          currentSlide.hidden = false;
          currentSlide.setAttribute("aria-hidden", "false");
          currentDot.setAttribute("aria-current", "true");

          const {
            images: { webp, png },
            name,
          } = crew[idx];

          document.getElementById("crewImageWebp").src = webp;
          document.getElementById("crewImageFallback").src = png;
          document.getElementById("crewImageFallback").alt =
            `Portrait of ${name}`;

          current = idx;

          nextSlide();
        };

        crew.forEach((_, idx) => {
          document.getElementById(`dot${idx}`).addEventListener("click", () => {
            showSlide(idx);
          });
        });

        nextSlide();
      })();
    </script>
  </Container>
</BaseLayout>

<style>
  body {
    background-image: url("./assets/crew/background-crew-mobile.jpg");
  }

  .crew__title {
    text-align: center;
  }

  .crew-details__title,
  .crew__title span {
    color: var(--clr-aluminium);
  }

  .slide {
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    gap: 10px;
  }

  .slide *:nth-child(3) {
    margin-top: 24px;
    text-align: center;
  }

  .crew-picture {
    width: 100%;
    max-width: 539px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    margin-inline: auto;
  }

  .crew-image {
    width: 271px;
    height: 340px;
    aspect-ratio: 271 / 340;
    object-fit: contain;
  }

  .dot {
    width: 12px;
    height: 12px;
    border-radius: 9999px;
    background-color: #888;
    border: none;
    cursor: pointer;
  }

  .dot[aria-current="true"] {
    background-color: #fff;
  }

  @media screen and (min-width: 48em) {
    body {
      background-image: url("./assets/crew/background-crew-tablet.jpg");
    }

    .crew {
      max-width: 688px;
    }

    .crew-image {
      width: 446px;
      height: 560px;
      aspect-ratio: 446 / 560;
    }
  }

  @media screen and (min-width: 90em) {
    body {
      background-image: url("./assets/crew/background-crew-desktop.jpg");
    }

    .crew {
      max-width: 1110px;
    }

    .crew-information {
      position: relative;
      display: flex;
      flex-direction: row;
      justify-content: center;
      align-items: center;
      gap: 20px;
    }

    .slide {
      align-items: self-start;
    }

    .slide *:nth-child(3) {
      text-align: left;
    }

    .crew-picture,
    .crew-details {
      flex: 1;
    }

    .slide-indicators {
      position: absolute;
      bottom: 0;
      left: 0;
    }
  }
</style>
